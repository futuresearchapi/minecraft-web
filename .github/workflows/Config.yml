name: Update Config 

on:
  # Manual trigger
  workflow_dispatch:
  # Trigger after another workflow completes successfully
  workflow_run:
    workflows: ["Build and Test"]  # Replace with your actual workflow name
    types:
      - completed

jobs:
  update-config:
    runs-on: ubuntu-latest
    if: ${{ github.event_name == 'workflow_dispatch' || (github.event_name == 'workflow_run' && github.event.workflow_conclusion == 'success') }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Ensure dist directory exists
        run: mkdir -p dist

      - name: Update dist/config.json
        run: |
          cat > dist/config.json <<EOF
{
  "version": 1,
  "defaultHost": "<from-proxy>",
  "defaultProxy": "https://proxy.mcraft.fun",
  "mapsProvider": "https://maps.mcraft.fun/",
  "skinTexturesProxy": "",
  "peerJsServer": "",
  "peerJsServerFallback": "https://p2p.mcraft.fun",
  "promoteServers": [
    { "ip": "wss://play.mcraft.fun" },
    { "ip": "wss://play.webmc.fun", "name": "WebMC" },
    { "ip": "wss://ws.fuchsmc.net" },
    { "ip": "wss://play2.mcraft.fun" },
    { "ip": "wss://play-creative.mcraft.fun", "description": "Might be available soon, stay tuned!" },
    { "ip": "kaboom.pw", "version": "1.20.3", "description": "Very nice a polite server. Must try for everyone! (is a bit broken)" }
  ],
  "rightSideText": "A Minecraft client in the browser!",
  "splashText": "How?",
  "splashTextFallback": "Hello!",
  "defaultUsername": "dfngboy{0-9999}",
  "mobileButtons": [
    { "action": "general.drop", "actionHold": "general.dropStack", "label": "Q" },
    { "action": "general.selectItem", "actionHold": "", "label": "S" },
    { "action": "general.debugOverlay", "actionHold": "general.debugOverlayHelpMenu", "label": "F3" },
    { "action": "general.playersList", "actionHold": "", "icon": "pixelarticons:users", "label": "TAB" },
    { "action": "general.chat", "actionHold": "", "label": "" },
    { "action": "ui.pauseMenu", "actionHold": "", "label": "" }
  ]
}
EOF
